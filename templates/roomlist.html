{{ template "header.html" .}}
<div class="container">
    <h1>Room List</h1>
    <div class="row pt-3" id="group-list"></div>
</div>

<div class="col-sm-6 py-2" id="group-card" style="display: none">
    <div class="card shadow">
        <div class="card-body">
            <h5 class="card-title room-name">Room's name</h5>
            <p class="card-text room-desc">Room's description</p>
            <a class="btn btn-primary room-id">Join!</a>
        </div>
    </div>
</div>

<script>
    var host = '{{ .gc_host }}'
    $(document).ready(function () {
        $.ajax({
            type: "GET",
            url: host + "/groupchat",
            beforeSend: function(xhr) {
                xhr.setRequestHeader("X-Access-Token", getCookie("access_token"))
            },
            success: function(data, status, xhr) {
                var groupchats = data.data;
                groupchats.forEach(element => {
                    let gcCard = $("#group-card").clone()
                    $(gcCard).removeAttr("id")
                    $(gcCard).find(".room-name").html(element.name)
                    $(gcCard).find(".room-desc").html(element.description)
                    $(gcCard).find(".room-id").attr("onClick", "joinNow("+element.room_id+")")
                    $("#group-list").append(gcCard)
                    $(gcCard).show()
                });
            },
            error: function(xhr, status, error) {
                console.log(xhr.responseText)
            },
            dataType: "json"
        })
    })

    function joinNow(gId) {
        $.ajax({
            type: "PUT",
            url: host + "/groupchat",
            beforeSend: function(xhr) {
                xhr.setRequestHeader("X-Access-Token", getCookie("access_token"))
            },
            data: "room_id="+gId,
            success: function(xhr, status, error) {
                window.location.href = "/groupchat/list"
            },
            dataType: "json"
        })
    }
</script>

{{ template "footer.html" .}}